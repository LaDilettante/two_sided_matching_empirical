\chapter{Two-sided matching model}
\label{chap:model}

As discussed in Chapter~\ref{chap:literature_issues}, developing the two-sided
matching model for the FDI market can address long-standing issues in the FDI
literature. To do so, I draw insights from studies of matching markets in other
domains. Marriage is a prominent example of a matching market. Others include
the matching between firms and workers, federal judges and law clerks, or the
\textit{formateur} of a coalition government and other minority parties. In all
of these matching markets, actors from two disjoint sets evaluate the
characteristics of the other side and voluntarily form a match only if both deem
each other satisfactory.\footnote{Throughout the dissertation, I use ``two-sided
  matching market'' and ``matching market'' interchangeably. On the other hand,
  note that a two-sided market is not necessarily a matching market
  \citep{Rysman2009}.}

This chapter will proceed as follows. First, I discuss the game theory
literature of two-sided matching models, where much of the terminology and
insight originate. I highlight key results that are relevant to our goal of
estimating actors' preference in matching markets. Second, I describe the
two-sided logit model, first developed by \citet{Logan1996} to study the labor
market, and how I use a Bayesian Markov chain Monte Carlo (MCMC) approach to
estimate it.

\section{Game theory models of matching markets}
\label{sec:game_theory}

\citet{Gale1962} are the first to study the matching market, using marriage as
an example. In this market, there are two finite and disjoint sets of actors:
men and women. Each man has a preference over the women, which can be
represented as an ordered list, ranking each woman based on how much he likes
her. Vice versa, each woman also has a preference over the men.

The outcome of this market is a set of marriages, with none or some of people
prefer to remain single. We call such a set of marriages a \textit{matching}
$\mu$, which is a one-to-one function that matches a man with a woman. We refer
to $\mu(x)$ as the \textit{mate} of $x$. For convenience, we say that if an
individual decides to remain single, they are matched with themselves.

We define a matching $\mu$ as \textit{stable} if it cannot be improved by any
individual or any pair of agents. A matching can be improved in two ways. First,
an individual may prefer to remain single than to be matched with his or her
mate $\mu(x)$ under the current matching $\mu$. Second, a man and a woman may
prefer to be with one another rather than whom they are currently matched with.
Therefore, if a matching is stable, no one has a better option than their
current situation.

The first key result from the game theory literature is that for any set of
preference, there always exists a stable matching \citep{Gale1962}. The proof is
constructive, describing the ``deferred acceptance'' procedure that is
guaranteed to produce such a stable matching.\footnote{The ``deferred
  acceptance'' procedure works as follows. In the first stage, every man
  proposes to his preferred mate. Every woman rejects all of her suitors except
  the one that she most prefers. However, she does not yet accept her (so far)
  favorite suitor, but keeps him along. In the second stage, every man that was
  rejected in the previous round proposes to his second choice. Every woman then
  picks her favorite from the set of new proposers and the man she keeps along
  from the previous round. The procedure continues until there is no longer any
  woman that is unmatched, at which point women finally accept their current
  favorite choices. (This procedure is called \textit{deferred acceptance} to
  capture the fact that women defer accepting her favorite choice until the last
  round in case better options become available.) The resulting match is stable
  because, throughout the procedure, every woman has received all the offers
  that would have been made to her, and she has chosen her favorite among all of
  those offers. If there were any other man that she would prefer to her current
  match, that man would not have been available to her. Therefore, the final
  match cannot be further improved by any man or woman.} This result provides
some justifications for the assumption that the observed matching in real
matching market is stable, and that the agents' utility has already been
maximized. Our empirical model of two-sided matching markets thus needs to
describe a process that produces a stable matching.

While a central coordinator employing the ``deferred acceptance'' algorithm is
guaranteed to come up with a stable matching, it is unclear whether
decentralized markets, such as the labor market or the FDI market, would be able
to reach this outcome by themselves.\footnote{The deferred acceptance procedure
  was used in the market for US medical residency with enthusiastic
  participation from medical students and hospitals. The high participation rate
  indicates that the matching produced is stable enough to entice students and
  hospitals away from arranging their own matches outside of the centralized
  market.} The second key result from the game theory literature is that stable
matching in decentralized matching market is indeed possible, even likely. For
example, \citet{Roth2016} show that, starting from an arbitrary matching, the
market can converge to a stable matching with probability 1 if we allow random
blocking pairs, i.e. two individuals that are not matched but prefer each other
to their current match, to break off and form their own match. In addition,
\citet{Adachi2003} shows that a random search process, in which pairs of man and
woman randomly meet and decide whether each other is better than their current
mates, will converge towards a stable matching if the search cost is
negligible.\footnote{In this model, searching has a time cost. Thus, negligible
  search cost is modeled as agents having a time discount close to 1.} These
results further suggest that the matching we observe in decentralized markets is
likely stable and that our empirical model ought to describe a process that
produces a stable matching.

The third key result is that all conclusions regarding the one-to-one matching
market (e.g. marriage) generalize to the many-to-one matching market (e.g. labor
market). However, there is an additional assumption: firms treat workers as
substitutes, not complements \citep{Roth1992}. In other words, firms never
regret hiring a worker even if another worker is no longer available. Therefore,
when we conduct empirical analysis of many-to-one markets, we should focus on
markets where agents have such ``substitutable preference.'' (For the FDI
market, this means that a country's offer to an MNC is not conditional on its
offer to another.) Otherwise, a stable matching is not guaranteed, and it
becomes unclear what kind of matching process our empirical model should
approximate.

\section{Empirical models of matching markets}

The game theory literature takes agents' preference as given and proves the
existence of a stable matching. In contrast, empirical models of matching
markets take the observed matching as given and attempt to estimate agents'
preference.

Unfortunately, most extant empirical models fail to adequately account for the
structure of a two-sided matching market. Often, researchers simply analyze the
market from one side, e.g. estimating a firm's preference by looking at the type
of workers it hires. This approach does not take into account the fact that a
match depends not only on an agent's preference but also his opportunity. For
example, a farm may want to hire highly-educated workers but cannot do so
because highly-educated workers do not want to work on farms. Modeling this
interaction between preference and opportunity is a key contribution of my
research.

Alternatively, some researchers measure agents' preferences by surveying them
directly \citep{Posner2001, Sprecher1994}. While this approach circumvents the
need to disentangle preference and opportunity, surveys can only measure agents'
\textit{stated} preference. In addition, such surveys require a high data
collection effort while data on final matching (e.g. married couples, workers'
current job, country location of MNCs) are widely available. My research aims to
make use of such matching data to estimate agents' \textit{revealed} preference.

In addition to academic research, companies have also developed a commercial
interest in studying two-sided matching markets, e.g. online marketplaces
(AirBnB), dating sites (eHarmony), or job board (Elance). To help their users
discover a match quicker, these sites often build a recommender system that
suggests potential matches.\footnote{To clarify, the term ``recommender system''
  typically refers to systems that recommend items to users based on the reviews
  of users like them. That is not what we are discussing here. Instead, we focus
  on matching markets where the recommender system recommends users to one
  another.} To maximize user engagement and profitability, these sites are
incentivized to make recommendations that resemble a stable matching so that
their users get the best match possible. And to find the stable matching,
ultimately they need to estimate the preference of their users.

While most of these algorithms are proprietary, some works in this area are
published. An interesting approach is the paper by \citet{Tu2014}, which uses
the latent Dirichlet allocation (LDA) model to uncover the latent types of users
based on their activities on an online dating platform.\footnote{Besides
  \citet{Tu2014}, \citet{Hitsch2010, Goswami2014} are two other attempts to
  estimate users' preference in online matching markets. However, these papers
  take a simple one-sided approach, ignoring the interplay between preference
  and opportunity.} In the original application of LDA model in topic modeling,
each document is a mixture of latent topics, and each topic is a distribution
over words. In this application of online dating, each user is a mixture of
latent ``types,'' and each type is a distribution signifying relative preference
over various mates' features. For example, the ``outdoor type'' may have higher
preference for athleticism or dog ownership over other traits.

While the LDA model works well for the online dating market, it is not
applicable to most social science problems for two reasons. First, this model
requires data of users reaching out to multiple partners rather than just the
final match. Second, the LDA model only clusters users' into latent types
without describing what these types may mean, leaving it up to the analyst to
attach substantive labels to these types. In contrast, social scientists likely
want to estimate the preference of pre-defined types such as genders, age
ranges, or occupation groups. Therefore, while the LDA model is suitable for
exploratory and predictive purposes, it does not have the interpretability that
social scientists desire.

\section{Two-sided logit model}

In this section, I present the two-sided logit model, a statistical model
especially designed to study many-to-one matching market, first proposed by
\cite{Logan1996}. For easier exposition, throughout the chapter I will use the
familiar example of the labor market, where many workers can be matched to one
firm.

We assume that the matching process in the labor market happens in two stages.
In the first stage, each firm evaluates each worker in the sample, deciding
whether to hire that worker or not. At the end of this stage, each worker will
have received a set of offers from firms, which we call his \textit{opportunity
  set}. In the second stage, each worker evaluates the firms in his opportunity
set and chooses the firm that he likes best. This constitutes the final,
observed match between a worker and a firm. This is a many-to-one matching
problem because a firm can make offers to multiple workers, none, some, or all
of which can be accepted by workers.

In this model, firms and workers decide sequentially, with firms making offers
first in order for workers to have opportunity sets to choose from. While firms
and workers in real life certainly do not act in this sequential manner, the
idea of the opportunity set is still applicable. Workers in the real labor
market may not know their exact set of offers, but they can certainly guess
which firms are within their reach based on their characteristics and on guesses
about firms' preference.

Our model only needs data on 1) the covariates of firms and workers, and 2) the
job that workers accept. Such data is widely available in many social science
surveys of the job market. Importantly, we do not need to observe the
opportunity set. Therefore, our model obviates the need to follow the matching
process and record who makes offer to whom, which is rarely possible for
researchers.

If we assume that firms and workers are utility-maximizing agents, at the end of
the matching process, no firm or worker would voluntarily change their final
matches. As discussed in Section~\ref{sec:game_theory}, this property is called
\textit{stability} in the game theoretic two-sided matching literature. We want
our model to have this property because matching markets tend to produce stable
matching.

This stability property does not imply that the matches will never change.
Indeed, if actors' preference shifts, their characteristics change, or new
actors enter the market, the matches will also change as a result of actors'
recalculating their utility and adjusting their decisions. Therefore, since we
are estimating actors' preference using only a snapshot of matching market, we
are making the assumption that on a systemic level, the average characteristics
of the actors and their preference remain sufficiently static for our estimates
to be meaningful.

This section will proceed as follows. First, I discuss the utility model for how
firms make offers to workers. Second, I discuss the utility model for how
workers choose the best offer among those extended by firms. Third, I show how
we can use a Bayesian MCMC approach to estimate the model.

\subsection{Modeling firms' decision making}
\label{sec:model_firm_decision_making}

A firm $j$'s decision on whether to hire worker $i$ rests on two utility
functions. First, firm $j$'s utility for hiring worker $i$ is:

\begin{align}
  U_j(i) &= \bm{\beta}_j' X_i + \epsilon_{1ij}
\end{align}

where $\beta_j$ is a vector of firm $j$'s preference for worker characteristics,
$x_i$ is a vector of worker $i$'s measured values on those characteristics, and
$\epsilon_{1ij}$ is the unobserved component that influences firm $j$'s utility.

On the other hand, the utility of not hiring worker $i$ is:

\begin{align}
  U_j(\neg i) &= b_j + \epsilon_{0ij}
\end{align}

where $b_j$ is the baseline utility of firm $j$, and $\epsilon_{0ij}$ is the
unobserved component that influences firm $j$'s utility.

Firm $j$ will make an offer to hire worker $i$ if $U_j(i) > U_j(\neg i)$.
Relevant worker characteristics (i.e. $X_i$) that a firm may consider are age,
education, or experience. The corresponding $\beta$'s represent the firm's
preference for these characteristics.

This model makes two important assumptions about firms' hiring process. First,
whether a firm decides to hire worker A depends on the characteristics of worker
A alone, i.e. it will continue to hire worker A regardless of whether another
worker B is available. In other words, firms regard workers as substitutes
rather than complements.\footnote{In the terminology of \citet{Roth1992}, firms
  are assumed to have ``substitutable preference,'' or firms' preference is
  assumed to have the property of substitutability. As discussed in
  Section~\ref{sec:game_theory}, this assumption is necessary to prove the
  existence of stable matching in the case of many-to-one matching.} This
assumption is not universally true. A Hollywood producer may want to hire two
specific lead actors for their chemistry, and if one is unavailable, the other
also has to be replaced. However, for large firms where workers are closer to
interchangeable pieces than unique superstars, this assumption is reasonable.

Second, the model assumes that the utility of hiring a worker does not depend on
how many other workers accept the offer. In other words, the firm is large
enough to employ all the workers to whom it extends offer without feeling the
effect of diminishing marginal productivity of labor. This assumption is less
restrictive than it may seem. Indeed, we can model the fact that the workers
under consideration are less productive than the previous batch of workers by
allowing firm $j$ to have a high baseline utility $b_j$. Therefore, we are not
assuming that there is never any diminishing marginal productivity of labor,
only that there is negligible diminishing effect between the first and the last
of the workers under consideration. This assumption is a reasonable
approximation if the firm's labor force is large compared to the number of
workers being considered.\footnote{While not concerned with diminishing marginal
  productivity, \citet{Roth1992} also assume that firms' quota, i.e. the number
  of workers they can accept, is sufficiently large to hire everyone in the set
  of workers under consideration. This assumption simplifies the proof that a
  stable match always exists in the case of many-to-one matching.}

In addition to the two above assumptions about the process of firm's decision
making, we make three parametric assumptions that are standard in the discrete
choice literature. First, we assume a linear utility function. Second, we assume
that the error terms $\epsilon_{1ij}, \epsilon_{0ij}$ are uncorrelated with one
another and across firms. Third, we assume that the as error terms
$\epsilon_{1ij}, \epsilon_{0ij}$ follow the Gumbel distribution.\footnote{The
  Gumbel distribution is very similar to the normal, only with a slightly fatter
  tail that allows for slightly more extreme variation in the unobserved
  utility. Its density function is $\exp^{-(x + \exp^{-x})}$, with mode 0, mean
  0.5772, and fixed variance $\frac{\pi^2}{6}$. In practice, the difference
  between using Gumbel and independent normal error terms is small
  \citep{Train2009}.} The choice of the Gumbel distribution is largely motivated
by convenience since it allows us to derive the probability of firm $j$ making
an offer to worker $i$ as the familiar binomial logit form:

\begin{align}
  Pr(o_{ij} = 1) &= Pr(U_j(i) > U_j(\neg i)) \\
                 &= Pr(\epsilon_{0ij} - \epsilon_{1ij} <  \bm{\beta}_j ' X_i - b_j) \\
                 &= \frac{\exp({\bm{\beta}_j'X_i})}{1 + \exp({\bm{\beta}_j'X_i})} \label{eq:prob_offer_ij} \\
  Pr(o_{ij} = 0) &= 1 - Pr(o_{ij} = 1) = \frac{1}{1 + \exp({\bm{\beta}_j'X_i})}
\end{align}

In Equation~\eqref{eq:prob_offer_ij}, the term $b_j$ is absorbed into
$\bm{\beta}$ when we add an intercept term to the covariate matrix $X$.

Once firms have made their offers, each worker $i$ will have a set of offers
from which to pick her favorite. We call this set of offers the
\textit{opportunity set} of worker $i$, denoted $O_i$. Since unemployment is
always an available option, every opportunity set includes unemployment as an
``offer.''

The probability of worker $i$ obtaining the opportunity set $O_i$ is:

\begin{align}
  p(O_i | \bm{\beta}) &= \prod_{j \in O_i} p(o_{ij} = 1 | \bm{\beta}) \prod_{j \notin O_i} p(o_{ij} = 0 | \bm{\beta}) \\
                      &= \prod_{j \in O_i} \frac{\exp(\bm{\beta_j} ' X_i)}{1 + \exp(\bm{\beta_j}' X_i)}
                        \prod_{j \notin O_i} \frac{1}{1 + \exp(\bm{\beta_j}' X_i)} \label{eq:conditional_probability_of_offer}
\end{align}

\subsection{Modeling workers' decision making}

Worker $i$'s utility for the accepting an offer from firm $j$ is:

\begin{align}
  V_i(j) &= \alpha' W_{j} + v_{ij}
\end{align}

where $\alpha$ is a vector of workers' preference for relevant characteristics
of firms, $W_j$ is a vector of firm $j$'s measured values on those
characteristics, and $v_{ij}$ is the unobserved component that influences worker
$i$'s utility.

Worker $i$ evaluates all the firms in her opportunity set and selects the offer
that brings the highest utility. This decision of worker $i$ concludes the
matching process, resulting in the observed final match between a worker and her
chosen firm in our data.

We make two assumptions in modeling the worker's decision making. First, for
simplicity, we assume that all workers share the same set of preferences---hence
$\alpha$ does not have a subscript $i$. The model can be extended so that there
is heterogeneous preference among workers, either by estimating a separate model
for each worker type (i.e. no pooling) or by building a hierarchical model for
worker preference (i.e. partial pooling).

Second, we assume that the error term $v_{ij}$ are uncorrelated across $j$. In
other words, the unobserved factors in the utility of one job offer is
uncorrelated to the unobserved factors in the utility of another job
offer.\footnote{This assumption also gives rise to the Independence of the
  Irrelevant Alternatives (IIA) property. IIA implies that the relative odds of
  choosing between two alternatives depend only on the two alternatives under
  consideration. It does not depend on whether other alternatives are available
  or what their characteristics may be. Hence, other alternatives are considered
  ``irrelevant.''} This assumption is most likely not true: if worker $i$ values
some unobserved factors of an offer, she is likely to consider those same
factors in another offer as well. The hope is that we have modeled the observed
portion sufficiently well that the remaining unobserved factors are close to
white noise. In any case, this issue afflicts any application of discrete choice
models and is not unique to our setup.\footnote{The discrete choice literature
  has developed solutions for such correlated error structure, such as nested
  logit, probit, and mixed logit, that can be applied here if we suspect that
  the unobserved portion is strongly correlated.}

Similar to our model of firm's utility, our model of worker's utility has three
additional parametric assumptions that are standard in the discrete choice
literature. First, we assume that utility is linear. Second, the error term
$v_{ij}$ are uncorrelated across $i$. Third, we model $v_{ij}$ having a Gumbel
distribution so that the probability that worker $i$ will accept the offer of
firm $j$ out of all the offers in its opportunity set $O_i$ takes the
conditional logit form \citep{Cameron2005}:

\begin{align}
  p(A_i = a_i | O_i, \alpha_i) = \frac{\exp(\alpha'W_{a_i})}{\sum\limits_{j:j \in O_i} \exp(\alpha'W_j)} \label{eq:conditional_probability_of_accept}
\end{align}

where $a_i$ is the index of the firm that $i$ accepts to to work for, and
Unemployment is indexed as 0.

\subsection{Model estimation}

Our goal is to estimate the preference of firms and workers, i.e. $\beta_j$ and
$\alpha$. The key insight is that, conditional on the opportunity set being
observed, the model of firms' and workers' decision making is a straightforward
application of the binary logit and conditional logit models. Both models can be
estimated with familiar tools such as Maximum Likelihood Estimation (MLE).

However, in most social science research problems, the researcher only observes
the final match $A$ and not the opportunity set $O$. For example, labor market
data typically does not include the set of offers a worker received (or would
have received if she had applied), while data on her current job is widely
available. Similarly in the marriage market or the FDI market, researchers often
do not have the data on the offers being made, and only observe the final
matching between men and women (i.e. who is married to whom) and between MNCs
and countries (i.e. which subsidiary is located where).

\citet{Logan1998}'s solution to this problem is to use the
Expectation-Maximization (EM) algorithm, an iterative method capable of finding
the maximum likelihood estimates when the model depends on unobserved latent
variables (i.e. the unobserved opportunity set in this case)
\citep{Dempster1977}. My innovation is to estimate the model using a Bayesian
MCMC approach, which offers several advantages. First, our MCMC approach
produces the full posterior distribution, making inference and prediction easy.
In contrast, EM only produces point estimates out of the
box.\footnote{\citet{Jamshidian2000} propose a method for estimating the
  standard error of EM estimates. However, for hypothesis testing, we need
  further assumptions about the distribution of the EM estimates.} Second, our
MCMC approach can be faster than EM when the latent variable, i.e. the
opportunity set, is high dimensional \citep{Ryden2008}.\footnote{Indeed, our
  opportunity set $O$ is a $(I \times J)$ matrix of 0s and 1s, where $I$ is the
  number of workers and $J$ is the number of firms. Thus, there are $2^{IJ}$
  potential values for the opportunity set, which quickly becomes untenable even
  for a small number of $I$ and $J$. The high dimension of $O$ forces
  \citet{Logan1998} to reduce the data dimension by aggregating 17 employers in
  the data into 5 employer types, e.g. professional or blue collar jobs.} Third,
within the Bayesian framework, I can naturally put a hierarchical structure on
firms' preference. This allows me to borrow information across firms, producing
more precise estimates even when there is not a lot of data for a specific
firm.\footnote{While it is possible to build frequentist hierarchical model,
  inference is less straightforward. See a discussion at \citet{Hornik2017}.}

\subsection{Model estimation using Bayesian MCMC}

We are interested in the posterior distribution of workers' and firms'
preference given the observed final match, i.e. $p(\alpha, \beta | A)$.
Unconditioned on the opportunity set, this posterior is difficult to derive or
sample from. Therefore, we sample from the augmented posterior $p(\alpha, \beta,
O | A)$, whose density is much simpler to derive.\footnote{See
  \citet{Tanner1987} for a discussion of such data augmentation techniques.}
Specifically,

\begin{align}
  p(\alpha, \beta, O | A) &= \frac{p(A | \alpha, \beta, O) p(\alpha, \beta, O)}{p(A)} \\
                          &\propto p(A|O, \alpha) p(O|\beta) p(\alpha) p(\beta) 
                            \label{eq:posterior_density}
\end{align}

where $p(A|O, \alpha)$ is derived in
\eqref{eq:conditional_probability_of_accept}, $p(O|\beta)$ is derived in
\eqref{eq:conditional_probability_of_offer}, $p(\alpha)$ and $p(\beta)$ are
prior distributions for $\alpha$ and $\beta$. A key insight of this equation is
that the acceptance of offers, i.e. $p(A|O, \alpha)$, depends only on the
opportunity set and on the workers' preference. Similarly, the opportunity sets,
i.e. $p(O|\beta)$, depend only on firms' preference.

Because the opportunity set $O$ is a discrete matrix of 0's and 1's, there is
not any convenient conjugate model for \eqref{eq:posterior_density}, making
Gibbs sampling impossible. Therefore, we use Metropolis-Hastings instead, a
technique to sample from an arbitrary distribution $p(\theta)$ using the
following steps:

\begin{enumerate}
\item Start from an arbitrary value of $\theta$
\item Generate a proposal value $\theta^*$ from the proposal distribution
  $q(\theta^*|\theta)$
\item Calculate the acceptance ratio $MH_{\theta} =
  \frac{p(\theta^*)q(\theta|\theta*)}{p(\theta)q(\theta^*|\theta)}$
\item Accept the proposed value $\theta^*$ with probability $\max(1,
  MH_{\theta})$
\item Repeat step 2-4 until convergence
\end{enumerate}

In our case, we will use symmetric proposal distributions, i.e.
$p(\theta^*|\theta)$ = $p(\theta | \theta^*) \forall \theta, \theta^*$, so that
the MH acceptance ratio simplifies to $MH_{\theta} =
\frac{p(\theta^*)}{p(\theta)}$.

Below we describe how to sample from the posterior of each parameter in the
model using the Metropolis-Hastings (MH) algorithm. More detailed derivation of
the MH acceptance ratio is included in Appendix~\ref{chap:MH_ratio}. We ensure
that our derivation and implementation of the acceptance ratio is correct using
the unit-testing approach suggested by \citet{Grosse2014}.

\textbf{Sampling from the posterior of the opportunity set $p(O|A, \alpha,
  \beta)$}

For each worker $i$, we propose a new value $O_i^*$ by flipping random cells in
the current opportunity set $O_i$ from 0 to 1 and 1 to 0. Substantively, this is
equivalent to perturbing the opportunity set by randomly making new offers or
withdrawing existing offers. Note that this proposal distribution is indeed
symmetric because proposing $O_i^*$ from $O_i$ and proposing $O_i$ from $O_i^*$
both involve flipping the same cells in the opportunity set. Hence,
$p(O_i^*|O_i) = p(O_i|O_i^*) =$ the probability of selecting these particular
cells out of the opportunity set.

The MH acceptance ratio for the proposed opportunity set $O_i^*$ is

\begin{align}
  MH_O &= \frac{p(O_i^* | A_i, \alpha, \bm{\beta})}{p(O_i | A_i, \alpha, \bm{\beta})} \\
       &= \frac{\sum\limits_{j:j \in O_i} \exp(\alpha'W_j)}{\sum\limits_{j:j \in O_i} \exp(\alpha'W_j) \pm \exp(\alpha' W_{j^*})} \times \exp(\pm \bm{\beta}_{j^*}'X_i)
\end{align}

where $\pm$ evaluates to $+$ if $j^*$ is a new offer being added to the current
opportunity set, and evaluates to $-$ if $j^*$ is an existing offer being
withdrawn from the current opportunity set.

To understand the intuition behind this formula for $MH_O$, consider the
scenario in which we propose a new opportunity set for worker $i$ by adding an
offer from firm $j$. Since worker $i$ now has one more choice to choose from, it
becomes less likely that worker $i$'s accepted job is the best choice. This
makes the proposed opportunity set less consistent with the observed data than
the current opportunity set, and $MH_O$ should decrease accordingly. This is
reflected in the formula for $MH_O$ by the $\exp(\alpha'W_{j^*})$ term in the
denominator.

On the other hand, whether we should add the offer to the opportunity set also
depends on firm $j$'s preference for worker $i$. If hiring worker $i$ brings
firm $j$ net positive utility (i.e. $\bm{\beta}_{j^*}'X_i > 0$), we should add
the offer. This is reflected in the formula for $MH_O$ by the multiplier
$\exp(\bm{\beta}_{j*}'X_i)$, which is larger than 1 when $\bm{\beta}_{j^*}'X_i >
0$.

\textbf{Sampling from the posterior of workers' preference $p(\alpha|A, O,
  \beta)$}

We propose a new $\alpha^*$ using a Normal proposal distribution centered on the
current value $\alpha$ with a hand-tuned diagonal covariance matrix. The MH
acceptance ratio for the proposed $\alpha^*$ is:\footnote{We log-transform the
  MH acceptance ratio for better numerics.}

\begin{align}
  MH_\alpha &= \frac{\alpha^*|A, O, \beta)}{p(\alpha | A, O, \beta)} \\
  \log MH_\alpha &= \sum_i \Bigl[ (\alpha^* - \alpha)' W_{a_i} + \nonumber \\
            & \log\left(\sum\limits_{j:j \in O_i} \exp(\alpha' W_j)\right) -
              \log\left(\sum\limits_{j:j \in O_i} \exp(\alpha^{*\prime} W_j)\right) \Bigr] + \nonumber\\
            & \log p(\alpha^*) - \log p(\alpha)
\end{align}

\textbf{Sampling from the posterior of firms' preference $p(\beta|A, O,
  \alpha)$}

We propose a new $\bm{\beta}^*$ using a Normal adaptive proposal distribution
similar to $\alpha$. The MH acceptance ratio for the proposed $\beta$ is:

\begin{align}
  MH_\beta &= \frac{p(\beta* | A, O, \alpha)}{p(\beta | A, O, \alpha)} \\
  \log MH_\beta &= \sum_i \left[ \sum_{j \in O_i} \left(\beta_j^{*\prime}X_i - \beta_j^{\prime}X_i \right) + \sum_{j} \left( \log(1 + {\exp({\beta_j^{\prime}X_i})) - \log(1 +  \exp(\beta_j^{*\prime}X_i})) \right) \right] \nonumber \\
           & + \log p(\bm{\beta}^*) - \log p(\bm{\beta})
\end{align}


\textbf{Sampling from the posterior of $\beta$'s hyperparameters $\mu_{\beta},
  \tau_{\beta}$}

As discussed above, the Bayesian approach to estimating our two-sided model
allows us to put a hierarchical structure on the preference parameter. Here, we
model firms' preference $\bm{\beta}$ as being drawn from the multivariate normal
distribution $MVN(\mu_{\beta}, \tau_{\beta})$, where $\mu_{\beta}$ is the mean
and $\tau_{\beta}$ is the precision.

When the prior $p(\beta)$ is also normal, we have a conjugate multivariate
normal model, where $\mu_{\beta}$ and $\tau_{\beta}$ are the parameters while
$\beta$ is considered the ``data.''

Since the model is conjugate, we can sample from the posterior of $\mu_{\beta}$
and $\tau_{\beta}$ with Gibbs sampling. Their full conditional distribution of
$\mu_{\beta}$ is:

\begin{align}
  p(\mu_{\beta}) &\sim MVN(\mu_0, \Sigma_0) \\
  p(\mu_{\beta} | \beta, \tau_{\beta}) &\sim MVN(m, V) \text{ where } \\
  V &= (\Sigma_0^{-1} + n \tau_{\beta})^{-1} \\
  m &= (\Sigma_0^{-1} + n \tau_{\beta})^{-1} (\Sigma_0^{-1}\mu_0 + n \tau_{\beta} \bar \beta)
\end{align}

The full conditional distribution of $\tau_{\beta}$ is:

\begin{align}
  p(\tau_{\beta}) &\sim \text{Wishart}(\nu_0, S_0^{-1}) \\
  p(\tau_{\beta} | \beta, \mu_{\beta}) &\sim \text{Wishart}(\nu, S^{-1}) \text{ where } \\
  \nu &= \nu_0 + n \\
  S^{-1} &= \left(S_0 + \sum (\beta - \mu_{\beta})(\beta - \mu_{\beta})^{\prime}\right)^{-1}
\end{align}

\section{Conclusion}

This chapter reviews the game theoretic two-sided matching models, identifying
key assumptions and properties that empirical models of two-sided matching market
can take advantage of. A key property of matching market is that the final
matching is likely to be \textit{stable}, with no agents being able to form a
better match. Therefore, our two-sided logit model also aims to describe a
process that would result in a stable matching.

In addition to setting up the model, I have also discussed how to estimate it
using Bayesian MCMC, specifically the Metropolis-Hastings algorithm. This
approach provides us with several advantages over the current approach of EM
estimation. First, once we have the posterior distribution of preference
parameters, inference and prediction are very flexible and straightforward.
Second, the MCMC approach can be more computationally tractable in high
dimensions. Finally, we can use a hierarchical modeling approach to partially
pool information and better estimate firms' preference even if some firms have a
small sample size.

In the next chapter, I show simulation results and an analysis of US labor data,
demonstrating the correctness of my estimation procedure and exploring other
properties of the model.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "AnhLe_dissertation.tex"
%%% End:
